<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEO ADMIN PANEL | THE 20K LEGACY WALL</title>
    <style>
        body { background: #050505; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 40px; margin: 0; }
        .login-screen { text-align: center; margin-top: 100px; }
        input { background: #111; border: 1px solid #333; color: #facc15; padding: 12px; border-radius: 5px; width: 280px; margin-bottom: 10px; }
        button { background: #facc15; color: #000; border: none; padding: 12px 25px; font-weight: bold; cursor: pointer; border-radius: 5px; transition: 0.3s; }
        button:hover { background: #fff; }
        
        #admin-content { display: none; max-width: 900px; margin: 0 auto; }
        .order-card { background: #111; border: 1px solid #22c55e; padding: 25px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .order-card h3 { color: #facc15; margin-top: 0; }
        .input-group { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .input-group input { width: 45%; }
        .approve-btn { background: #22c55e; color: #fff; margin-top: 10px; }
        .reject-btn { background: #ef4444; color: #fff; margin-left: 10px; }
        .header-flex { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; margin-bottom: 30px; padding-bottom: 10px; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>

    <div id="login-box" class="login-screen">
        <h1 style="color: #facc15;">CEO ACCESS ONLY</h1>
        <p style="color: #666;">Please enter your administrative password</p>
        <input type="password" id="adminPass" placeholder="••••••••••••"><br>
        <button onclick="checkPassword()">LOGIN TO PANEL</button>
    </div>

    <div id="admin-content">
        <div class="header-flex">
            <h1>PENDING ORDERS</h1>
            <button onclick="location.reload()" style="background: #333; color: #fff; padding: 5px 15px;">REFRESH</button>
        </div>
        <div id="order-list">
            <p style="color: #888;">Checking for new orders...</p>
        </div>
    </div>

    <script>
        // ফায়ারবেস কনফিগারেশন (আপনার ডাটাবেস ইউআরএল)
        const firebaseConfig = {
            databaseURL: "https://the-10-million-pixels-plus-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // পাসওয়ার্ড চেক
        function checkPassword() {
            const pass = document.getElementById('adminPass').value;
            if(pass === "KAWSARahmed22@@") {
                document.getElementById('login-box').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                loadOrders();
            } else {
                alert("Incorrect Password! Access Denied.");
            }
        }

        // পেন্ডিং অর্ডার লোড করা
        function loadOrders() {
            db.ref('pending_orders').on('value', snapshot => {
                const list = document.getElementById('order-list');
                list.innerHTML = "";
                const data = snapshot.val();
                
                if(!data) {
                    list.innerHTML = "<p>No pending orders at the moment.</p>";
                    return;
                }

                Object.keys(data).forEach(id => {
                    const order = data[id];
                    list.innerHTML += `
                        <div class="order-card" id="card_${id}">
                            <h3>Brand: ${order.name}</h3>
                            <p>Assigned Plot ID: #${order.plotID} (Randomly generated)</p>
                            <div class="input-group">
                                <input type="text" id="img_${id}" placeholder="Image URL (Direct link to 60x40px logo)">
                                <input type="text" id="link_${id}" placeholder="Website URL (https://...)">
                            </div>
                            <button class="approve-btn" onclick="approveOrder('${id}', ${order.plotID}, '${order.name}')">APPROVE & PUBLISH</button>
                            <button class="reject-btn" onclick="rejectOrder('${id}')">REJECT</button>
                        </div>
                    `;
                });
            });
        }

        // অর্ডার অ্যাপ্রুভ এবং মেইন গ্রিডে পাবলিশ করা
        function approveOrder(id, plotID, brandName) {
            const imgUrl = document.getElementById('img_'+id).value;
            const webLink = document.getElementById('link_'+id).value;

            if(!imgUrl || !webLink) {
                alert("Please provide both Image URL and Website Link!");
                return;
            }

            // প্লটের X এবং Y পজিশন ক্যালকুলেশন (৬০x৪০ সাইজ অনুযায়ী)
            const x = (plotID % 100) * 60;
            const y = Math.floor(plotID / 100) * 40;

            const finalData = {
                name: brandName,
                imageUrl: imgUrl,
                link: webLink,
                x: x,
                y: y,
                plotID: plotID
            };

            // ১. মেইন পিক্সেল ডাটাবেসে সেভ করা
            db.ref('pixels/' + id).set(finalData)
            .then(() => {
                // ২. পেন্ডিং লিস্ট থেকে রিমুভ করা
                db.ref('pending_orders/' + id).remove();
                alert("Success! " + brandName + " is now live on the grid.");
            })
            .catch(error => alert("Update failed: " + error.message));
        }

        // অর্ডার রিজেক্ট করা
        function rejectOrder(id) {
            if(confirm("Are you sure you want to delete this request?")) {
                db.ref('pending_orders/' + id).remove();
            }
        }
    </script>
</body>
</html>
